<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#f3f4f6">
    <meta name="description" content="Capture your best ideas">
    <title>Notely</title>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --primary-soft: rgba(99, 102, 241, 0.08);
            --bg-body: #f3f4f6;
            --bg-glass: rgba(255, 255, 255, 0.9);
            --bg-card: #ffffff;
            --text-main: #111827;
            --text-muted: #6b7280;
            --border: rgba(229, 231, 235, 0.8);
            --border-strong: rgba(209, 213, 219, 0.8);
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --radius-lg: 20px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --font: 'Plus Jakarta Sans', sans-serif;
            --grad-brand: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --grad-bg: radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.05) 0%, transparent 40%),
                       radial-gradient(circle at 100% 100%, rgba(236, 72, 153, 0.05) 0%, transparent 40%);
        }

        [data-theme="dark"] {
            --primary: #818cf8;
            --primary-hover: #6366f1;
            --primary-soft: rgba(129, 140, 248, 0.12);
            --bg-body: #0f172a;
            --bg-glass: rgba(30, 41, 59, 0.9);
            --bg-card: #1e293b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            --border-strong: rgba(255, 255, 255, 0.15);
            --grad-bg: radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                       radial-gradient(circle at 100% 100%, rgba(236, 72, 153, 0.15) 0%, transparent 50%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font);
            background-color: var(--bg-body);
            background-image: var(--grad-bg);
            background-attachment: fixed;
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease;
        }

        .hidden { display: none !important; }
        button { cursor: pointer; border: none; background: none; font-family: inherit; color: inherit; }
        input, textarea, select { font-family: inherit; background: transparent; border: none; color: inherit; outline: none; }

        .page { display: none; height: 100vh; width: 100%; opacity: 0; transition: opacity 0.3s ease; }
        .page.active { display: flex; opacity: 1; }

        .dashboard-layout { display: flex; width: 100%; height: 100%; position: relative; }

        .sidebar {
            width: 280px;
            background: var(--bg-glass);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 50;
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .brand { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem; padding-left: 0.5rem; }
        .brand-logo {
            width: 40px; height: 40px; background: var(--grad-brand); border-radius: 12px;
            display: flex; align-items: center; justify-content: center; color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        .brand-text { font-size: 1.5rem; font-weight: 800; background: var(--grad-brand); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -0.03em; }

        .create-btn {
            background: var(--text-main); color: var(--bg-card); padding: 1rem; border-radius: var(--radius-md);
            font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 0.75rem;
            margin-bottom: 2rem; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .create-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
        [data-theme="dark"] .create-btn { background: var(--primary); color: white; }

        .nav-list { display: flex; flex-direction: column; gap: 0.5rem; }
        .nav-item {
            display: flex; align-items: center; gap: 1rem; padding: 0.75rem 1rem; border-radius: var(--radius-sm);
            color: var(--text-muted); font-weight: 600; font-size: 0.95rem; transition: all 0.2s; width: 100%; text-align: left;
        }
        .nav-item:hover { background: var(--bg-card); color: var(--text-main); }
        .nav-item.active { background: var(--bg-card); color: var(--text-main); box-shadow: var(--shadow-sm); }

        .nav-icon-box { width: 32px; height: 32px; border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .nav-item.all .nav-icon-box { background: rgba(99, 102, 241, 0.1); color: #6366f1; }
        .nav-item.personal .nav-icon-box { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .nav-item.work .nav-icon-box { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .nav-item.ideas .nav-icon-box { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }

        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        .header { padding: 1.5rem 2rem; display: flex; justify-content: space-between; align-items: center; z-index: 40; }

        .search-container { position: relative; width: 320px; }
        .search-input {
            width: 100%; background: var(--bg-glass); border: 2px solid transparent; padding: 0.75rem 1rem 0.75rem 2.75rem;
            border-radius: var(--radius-md); font-weight: 500; transition: all 0.2s; box-shadow: var(--shadow-sm);
        }
        .search-input:focus { background: var(--bg-card); border-color: var(--primary); }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-muted); pointer-events: none; }

        .user-actions { display: flex; gap: 0.75rem; }
        .icon-btn {
            width: 44px; height: 44px; border-radius: 14px; background: var(--bg-glass); display: flex; align-items: center; justify-content: center;
            color: var(--text-muted); transition: all 0.2s; border: 1px solid var(--border);
        }
        .icon-btn:hover { background: var(--bg-card); color: var(--text-main); transform: translateY(-2px); box-shadow: var(--shadow-sm); }

        .notes-area { flex: 1; overflow-y: auto; padding: 0 2rem 2rem; }
        .section-title { font-size: 1.75rem; font-weight: 800; margin-bottom: 1.5rem; letter-spacing: -0.03em; }

        .grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; padding-bottom: 6rem;
        }

        .card {
            background: var(--bg-card); border-radius: var(--radius-lg); padding: 1.75rem; border: 1px solid var(--border-strong);
            box-shadow: var(--shadow-sm); transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); cursor: pointer;
            min-height: 240px; display: flex; flex-direction: column; position: relative; overflow: hidden;
        }
        .card:hover { transform: translateY(-6px); box-shadow: var(--shadow-lg); border-color: var(--primary); }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 6px; background: var(--grad-brand);
            opacity: 0; transition: opacity 0.3s;
        }
        .card:hover::before { opacity: 1; }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
        .card-title { font-size: 1.25rem; font-weight: 700; color: var(--text-main); line-height: 1.3; }
        .card-body { color: var(--text-muted); font-size: 0.95rem; line-height: 1.6; flex: 1; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; }
        .card-footer { margin-top: 1.5rem; display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: var(--text-muted); font-weight: 500; }

        .card-tools {
            position: absolute; bottom: 1.5rem; right: 1.5rem; display: flex; gap: 0.5rem;
            opacity: 0; transform: translateY(10px); transition: all 0.2s;
        }
        .card:hover .card-tools { opacity: 1; transform: translateY(0); }
        @media (hover: none) { .card-tools { opacity: 1; transform: translateY(0); } }

        .tool-btn {
            width: 36px; height: 36px; border-radius: 10px; background: var(--bg-body); display: flex; align-items: center; justify-content: center;
            color: var(--text-muted); border: 1px solid var(--border-strong);
        }
        .tool-btn:hover { background: var(--text-main); color: white; border-color: var(--text-main); }
        .tool-btn.delete:hover { background: #ef4444; color: white; border-color: #ef4444; }

        .tag { padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.02em; }
        .tag.work { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .tag.personal { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .tag.ideas { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px);
            z-index: 200; opacity: 0; visibility: hidden; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }

        .modal {
            width: 90%; max-width: 600px; background: var(--bg-card); border-radius: var(--radius-lg); padding: 2.5rem;
            box-shadow: var(--shadow-lg); transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column; max-height: 90vh;
        }
        .modal-overlay.open .modal { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .modal-title { font-size: 1.5rem; font-weight: 800; }

        .auth-container { display: flex; align-items: center; justify-content: center; height: 100%; padding: 1.5rem; }
        .auth-box { width: 100%; max-width: 420px; background: var(--bg-card); padding: 3rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); text-align: center; }
        .input-field { width: 100%; background: var(--bg-body); padding: 1rem; border-radius: var(--radius-md); font-size: 1rem; margin-bottom: 1rem; border: 2px solid transparent; transition: all 0.2s; }
        .input-field:focus { background: var(--bg-card); border-color: var(--primary); }
        .btn-main { width: 100%; background: var(--primary); color: white; padding: 1rem; border-radius: var(--radius-md); font-weight: 700; font-size: 1rem; margin-top: 0.5rem; transition: transform 0.2s; }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }

        .auth-link {
            color: var(--primary); font-weight: 700; cursor: pointer; background: none; border: none;
            font-family: inherit; font-size: inherit; padding: 0; text-decoration: none;
        }
        .auth-link:hover { text-decoration: underline; }

        .sidebar-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
            z-index: 100; opacity: 0; visibility: hidden; transition: opacity 0.3s;
        }
        .sidebar-overlay.open { opacity: 1; visibility: visible; }

        .mobile-search-container {
            display: none;
            padding: 0 1.25rem 0.5rem;
        }
        .mobile-search-container .search-container {
            width: 100%;
        }

        .empty-state {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 4rem 2rem; text-align: center; color: var(--text-muted);
        }
        .empty-state svg { margin-bottom: 1.5rem; opacity: 0.4; }
        .empty-state h3 { font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--text-main); }
        .empty-state p { margin-bottom: 1.5rem; }
        .empty-state button {
            background: var(--primary); color: white; padding: 0.75rem 1.5rem; border-radius: var(--radius-md);
            font-weight: 700; font-size: 0.95rem; transition: transform 0.2s;
        }
        .empty-state button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }

        .loading-spinner {
            display: flex; align-items: center; justify-content: center; padding: 4rem 2rem;
        }
        .loading-spinner::after {
            content: ''; width: 40px; height: 40px; border: 4px solid var(--border-strong);
            border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite;
        }

        .scan-loading {
            display: flex; align-items: center; gap: 0.75rem; padding: 1rem; margin-top: 1rem;
            background: var(--primary-soft); border-radius: var(--radius-sm); color: var(--text-main); font-weight: 600;
        }
        .scan-loading::before {
            content: ''; width: 20px; height: 20px; border: 3px solid var(--border-strong);
            border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; flex-shrink: 0;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 1024px) {
            .sidebar { position: fixed; left: -100%; height: 100%; width: 85%; max-width: 320px; z-index: 150; box-shadow: var(--shadow-lg); }
            .sidebar.active { left: 0; }
            .header { padding: 1rem 1.25rem; }
            .notes-area { padding: 0 1.25rem 1.25rem; }
            .menu-toggle { display: block; }
            .search-container.desktop-search { display: none; }
            .mobile-search-container { display: block; }
            .grid { grid-template-columns: 1fr; }
            .card { min-height: 180px; }
            .modal { padding: 1.5rem; }
        }
        @media (min-width: 1025px) { .menu-toggle { display: none; } }

        .fab-mobile {
            position: fixed; bottom: 1.5rem; right: 1.5rem; width: 60px; height: 60px; background: var(--text-main); color: var(--bg-card);
            border-radius: 20px; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-lg); z-index: 90;
        }
        @media (min-width: 1025px) { .fab-mobile { display: none; } }
    </style>
</head>
<body>
    <div id="toast" role="status" aria-live="polite" style="position: fixed; top: 24px; left: 50%; transform: translateX(-50%) translateY(-100px); background: var(--text-main); color: var(--bg-card); padding: 12px 24px; border-radius: 50px; font-weight: 600; box-shadow: var(--shadow-lg); z-index: 300; transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);"></div>

    <div id="login-page" class="page active">
        <div class="auth-container">
            <div class="auth-box">
                <div class="brand-logo" style="width: 64px; height: 64px; margin: 0 auto 1.5rem; border-radius: 20px;">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/><path d="M7 7h10"/><path d="M7 12h10"/><path d="M7 17h6"/></svg>
                </div>
                <h1 style="font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem; color: var(--text-main);">Welcome back</h1>
                <p style="color: var(--text-muted); margin-bottom: 2rem;">Your thoughts, organized.</p>
                <form onsubmit="handleLogin(event)">
                    <input type="email" id="login-email" class="input-field" placeholder="Email address" aria-label="Email address" required>
                    <input type="password" id="login-password" class="input-field" placeholder="Password" aria-label="Password" required>
                    <button type="submit" class="btn-main">Sign In</button>
                </form>
                <div style="margin-top: 1.5rem; color: var(--text-muted);">
                    New here? <button class="auth-link" onclick="switchAuth('register')">Create Account</button>
                </div>
            </div>
        </div>
    </div>

    <div id="register-page" class="page">
        <div class="auth-container">
            <div class="auth-box">
                <h1 style="font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem; color: var(--text-main);">Join Notely</h1>
                <p style="color: var(--text-muted); margin-bottom: 2rem;">Start capturing your best ideas.</p>
                <form onsubmit="handleRegister(event)">
                    <input type="text" id="reg-name" class="input-field" placeholder="Your Name" aria-label="Your Name" required>
                    <input type="email" id="reg-email" class="input-field" placeholder="Email address" aria-label="Email address" required>
                    <input type="password" id="reg-pass" class="input-field" placeholder="Password" aria-label="Password" required>
                    <div id="registerError" style="color: #ef4444; font-weight: 600; margin-top: 0.75rem; display: none;"></div>
                    <button type="submit" class="btn-main">Create Account</button>
                </form>
                <div style="margin-top: 1.5rem; color: var(--text-muted);">
                    Already have an account? <button class="auth-link" onclick="switchAuth('login')">Sign In</button>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboard-page" class="page">
        <div class="dashboard-layout">
            <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

            <aside id="sidebar" class="sidebar">
                <div class="brand">
                    <div class="brand-logo">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/><path d="M7 7h10"/><path d="M7 12h10"/><path d="M7 17h6"/></svg>
                    </div>
                    <span class="brand-text">Notely</span>
                </div>
                <div style="margin-bottom: 1.5rem; font-weight: 600; color: var(--text-main); font-size: 1.1rem; padding-left: 0.5rem;">
                    Welcome back, <span id="user-name-display" style="color: var(--primary);">User</span>!
                </div>
                <button class="create-btn" onclick="openModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Create Note
                </button>
                <nav class="nav-list">
                    <button class="nav-item all active" onclick="filterCategory('all', this)">
                        <div class="nav-icon-box"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h7v7H3z"/><path d="M14 3h7v7h-7z"/><path d="M14 14h7v7h-7z"/><path d="M3 14h7v7H3z"/></svg></div>
                        All Notes
                    </button>
                    <button class="nav-item personal" onclick="filterCategory('personal', this)">
                        <div class="nav-icon-box"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
                        Personal
                    </button>
                    <button class="nav-item work" onclick="filterCategory('work', this)">
                        <div class="nav-icon-box"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg></div>
                        Work
                    </button>
                    <button class="nav-item ideas" onclick="filterCategory('ideas', this)">
                        <div class="nav-icon-box"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9.663 17h4.673M12 3a7 7 0 0 1 7 7c0 2.38-1.19 4.468-3 5.74V17a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2v-1.26C6.19 14.468 5 12.38 5 10a7 7 0 0 1 7-7z"/></svg></div>
                        Ideas
                    </button>
                </nav>
            </aside>

            <main class="main-content">
                <header class="header">
                    <button class="menu-toggle icon-btn" style="margin-right: 1rem;" onclick="toggleSidebar()" aria-label="Toggle menu">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                    </button>
                    <div class="search-container desktop-search">
                        <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                        <input type="text" class="search-input" placeholder="Search your notes..." aria-label="Search notes" oninput="filterNotes(this.value)">
                    </div>
                    <div class="user-actions">
                        <button class="icon-btn" onclick="toggleTheme()" aria-label="Toggle dark mode"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></button>
                        <button class="icon-btn" style="color: #ef4444; border-color: rgba(239, 68, 68, 0.2);" onclick="logout()" aria-label="Sign out"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></button>
                    </div>
                </header>
                <div class="mobile-search-container">
                    <div class="search-container">
                        <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                        <input type="text" class="search-input" placeholder="Search your notes..." aria-label="Search notes" oninput="filterNotes(this.value)">
                    </div>
                </div>
                <div class="notes-area">
                    <h2 class="section-title">My Notes</h2>
                    <div id="notes-grid" class="grid"></div>
                </div>
            </main>
        </div>
        <button class="fab-mobile" onclick="openModal()" aria-label="Create new note">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        </button>
    </div>

    <div id="note-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Edit Note</span>
                <button class="icon-btn" style="width: 36px; height: 36px;" onclick="closeModal()" aria-label="Close modal"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
            </div>
            <input type="text" id="note-title" placeholder="Title" aria-label="Note title" style="font-size: 1.5rem; font-weight: 800; width: 100%; margin-bottom: 1.5rem; color: var(--text-main);">
            <textarea id="note-content" placeholder="Start typing..." aria-label="Note content" style="flex: 1; resize: none; font-size: 1rem; line-height: 1.6; color: var(--text-muted);"></textarea>
            <div id="scan-loading" class="scan-loading" style="display: none;">Scanning image for text...</div>
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 2rem; align-items: center;">
                <select id="note-category" aria-label="Note category" style="padding: 0.75rem; background: var(--bg-body); border-radius: var(--radius-sm); color: var(--text-main); font-weight: 600; min-width: 120px;">
                    <option value="general">No Category</option>
                    <option value="personal">Personal</option>
                    <option value="work">Work</option>
                    <option value="ideas">Ideas</option>
                </select>
                <div style="flex: 1;"></div>
                <button class="icon-btn" style="width: auto; padding: 0 1rem; gap: 0.5rem; font-weight: 600;" onclick="triggerScan()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7"/><line x1="16" y1="5" x2="22" y2="5"/><line x1="19" y1="2" x2="19" y2="8"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg> Scan
                </button>
                <button class="btn-main" style="width: auto; padding: 0 2rem; margin: 0;" onclick="saveNote()">Save</button>
            </div>
            <input type="file" id="scan-input" hidden accept="image/*" onchange="handleScan(event)">
        </div>
    </div>

    <script>
        const API_URL = "";
        let state = { token: localStorage.getItem('token'), name: localStorage.getItem('name'), notes: [], editingId: null, category: 'all' };

        function escapeHtml(str) {
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(str));
            return div.innerHTML;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const theme = localStorage.getItem('theme');
            if(theme) document.documentElement.setAttribute('data-theme', theme);
            if(state.token) {
                showPage('dashboard-page');
                updateWelcomeMessage();
                fetchNotes();
            }
            else showPage('login-page');
        });

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function switchAuth(type) { showPage(type === 'login' ? 'login-page' : 'register-page'); }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            const overlay = document.getElementById('sidebar-overlay');
            overlay.classList.toggle('open');
        }

        function toast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.style.transform = 'translateX(-50%) translateY(0)';
            setTimeout(() => t.style.transform = 'translateX(-50%) translateY(-100px)', 3000);
        }

        function updateWelcomeMessage() {
            const nameDisplay = document.getElementById('user-name-display');
            if (state.name) {
                nameDisplay.textContent = state.name;
            } else {
                nameDisplay.textContent = 'User';
            }
        }

        async function api(endpoint, method = 'GET', body = null) {
            const opts = { method, headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.token}` } };
            if(body) opts.body = JSON.stringify(body);
            try {
                const res = await fetch(API_URL + endpoint, opts);
                if(res.status === 401) logout();
                if (res.status === 204) return { success: true };
                const text = await res.text();
                if (!res.ok) return null;
                return text ? JSON.parse(text) : { success: true };
            } catch(e) { return null; }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const res = await api('/auth/login', 'POST', { email, password });
            if(res && res.token) {
                state.token = res.token;
                state.name = res.name || 'User'; // Assuming the backend returns the name
                localStorage.setItem('token', res.token);
                localStorage.setItem('name', state.name);
                showPage('dashboard-page');
                updateWelcomeMessage();
                fetchNotes();
            } else toast('Invalid credentials');
        }

        async function handleRegister(e) {
            e.preventDefault();
            const errorEl = document.getElementById('registerError');
            errorEl.style.display = 'none';
            errorEl.textContent = '';
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-pass').value;
            try {
                const res = await fetch(API_URL + '/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                const data = await res.json().catch(() => null);
                if (res.ok) {
                    toast('Account created! Please log in.');
                    switchAuth('login');
                } else {
                    const msg = (data && data.error) ? data.error : 'Registration failed.';
                    errorEl.textContent = msg;
                    errorEl.style.display = 'block';
                }
            } catch {
                errorEl.textContent = 'Registration failed.';
                errorEl.style.display = 'block';
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('name');
            location.reload();
        }

        async function fetchNotes() {
            const grid = document.getElementById('notes-grid');
            grid.innerHTML = '<div class="loading-spinner"></div>';
            const res = await api('/notes?page=1&pageSize=100');
            if(res) { state.notes = res.data || []; renderNotes(); }
            else { grid.innerHTML = ''; }
        }

        function renderNotes() {
            const grid = document.getElementById('notes-grid');
            grid.innerHTML = '';
            let filtered = state.notes;
            if(state.category !== 'all') filtered = filtered.filter(n => (n.content||'').toLowerCase().includes('#'+state.category));

            if(filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                        <h3>No notes yet</h3>
                        <p>Create your first note to get started.</p>
                        <button onclick="openModal()">Create Note</button>
                    </div>
                `;
                return;
            }

            filtered.forEach((note, i) => {
                const el = document.createElement('div');
                el.className = 'card';
                el.style.animation = `fadeIn 0.4s ease backwards ${i * 0.05}s`;
                el.onclick = (e) => {
                    if(!e.target.closest('button')) openModal(note);
                };

                const content = note.content || '';
                let tag = '';
                if(content.includes('#work')) tag = '<span class="tag work">Work</span>';
                else if(content.includes('#personal')) tag = '<span class="tag personal">Personal</span>';
                else if(content.includes('#idea')) tag = '<span class="tag ideas">Idea</span>';

                el.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${escapeHtml(note.title)}</div>
                        ${tag}
                    </div>
                    <div class="card-body">${escapeHtml(content) || 'No content'}</div>
                    <div class="card-footer">
                        <span>${new Date(note.updatedAt).toLocaleDateString()}</span>
                    </div>
                    <div class="card-tools">
                        <button class="tool-btn" aria-label="Edit note" onclick="openModal(state.notes.find(n=>n.id==='${note.id}'))">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                        </button>
                        <button class="tool-btn delete" aria-label="Delete note" onclick="deleteNote(event, '${note.id}')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        </button>
                    </div>
                `;
                grid.appendChild(el);
            });
        }

        function filterCategory(cat, btn) {
            state.category = cat;
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderNotes();
            if(window.innerWidth <= 1024) toggleSidebar();
        }

        function filterNotes(query) {
            const lower = query.toLowerCase();
            document.querySelectorAll('.card').forEach(c => {
                c.style.display = c.innerText.toLowerCase().includes(lower) ? 'flex' : 'none';
            });
        }

        function openModal(note = null) {
            state.editingId = note ? note.id : null;
            document.getElementById('note-title').value = note ? note.title : '';
            document.getElementById('note-content').value = note ? note.content : '';
            const catSelect = document.getElementById('note-category');
            catSelect.value = 'general';
            if(note) {
                if(note.content.includes('#work')) catSelect.value = 'work';
                if(note.content.includes('#personal')) catSelect.value = 'personal';
                if(note.content.includes('#idea')) catSelect.value = 'ideas';
            }
            document.getElementById('scan-loading').style.display = 'none';
            document.getElementById('note-modal').classList.add('open');
        }

        function closeModal() { document.getElementById('note-modal').classList.remove('open'); }

        async function saveNote() {
            const title = document.getElementById('note-title').value;
            let content = document.getElementById('note-content').value;
            const cat = document.getElementById('note-category').value;
            if(cat !== 'general' && !content.includes('#'+cat)) content += `\n#${cat}`;

            const method = state.editingId ? 'PUT' : 'POST';
            const url = state.editingId ? `/notes/${state.editingId}` : '/notes';
            const res = await api(url, method, { title, content });
            if(res) {
                closeModal(); fetchNotes(); toast('Note saved');
            } else {
                toast('Failed to save note');
            }
        }

        async function deleteNote(e, id) {
            e.stopPropagation();
            if(confirm('Delete note?')) { await api(`/notes/${id}`, 'DELETE'); fetchNotes(); toast('Note deleted'); }
        }

        function triggerScan() { document.getElementById('scan-input').click(); }

        async function handleScan(e) {
            const file = e.target.files[0];
            if(!file) return;
            const fd = new FormData(); fd.append('file', file);
            const scanLoader = document.getElementById('scan-loading');
            scanLoader.style.display = 'flex';
            toast('Scanning...');
            try {
                const res = await fetch(API_URL + '/notes/upload', {
                    method: 'POST', headers: { 'Authorization': `Bearer ${state.token}` }, body: fd
                });
                scanLoader.style.display = 'none';
                if(res.ok) { toast('Scan complete!'); fetchNotes(); closeModal(); }
                else toast('Scan failed');
            } catch(err) { scanLoader.style.display = 'none'; toast('Error uploading'); }
            e.target.value = '';
        }
    </script>
</body>
</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 